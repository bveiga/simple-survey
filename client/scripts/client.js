"use strict";var app=angular.module("simpleSurveyUi",["ngResource","ngRoute","ngStorage"]);app.config(["$routeProvider","$locationProvider","$httpProvider",function(e,t,n){e.when("/",{templateUrl:"../views/home.html",controller:"HomeController",controllerAs:"home"}).when("/survey",{templateUrl:"../views/survey.html",controller:"SurveyController",controllerAs:"survey"}).when("/admin",{templateUrl:"../views/admin.html",controller:"AdminController",controllerAs:"admin"}).otherwise({redirectTo:"/"}),t.html5Mode(!0),n.defaults.useXDomain=!0,n.interceptors.push(["$q","$location","$localStorage",function(e,t,n){return{request:function(e){var o=t.path();return o.indexOf("/api")>-1&&(e.headers=e.headers||{},n.surveyUser.token&&(e.headers.Authorization="Bearer "+n.surveyUser.token)),e}}}])}]),app.factory("Page",function(){var e="Simple Survey",t=!1;return{title:function(){return e},setTitle:function(t){e=t},getLH:function(){return t},setLH:function(e){t=e}}}),app.controller("MainController",["$scope","Page",function(e,t){e.Page=t}]),angular.module("simpleSurveyUi").controller("AdminController",["$scope","$location","$route","AdminService","Page",function(e,t,n,o,r){r.setTitle("Simple Survey | Admin Dashboard"),r.setLH(!0),e.listOfQuestions=[],o.getQuestionResponses(function(t){e.listOfQuestions=t}),e.createQuestion=function(){e.loading=!0,o.createQuestion(e.question,function(t){t.success?n.reload():(e.error=t.message,e.loading=!1)})}}]),angular.module("simpleSurveyUi").controller("HomeController",["$scope","$location","AuthenticationService","Page",function(e,t,n,o){o.setTitle("Simple Survey | Welcome"),o.setLH(!1),e.login=function(){e.loading=!0,n.Login(e.email,e.password,function(n){n.success===!0?n.isAdmin?t.path("/admin"):t.path("/survey"):(e.error=n.message,e.loading=!1)})}}]),angular.module("simpleSurveyUi").controller("SurveyController",["$scope","$location","SurveyService","Page",function(e,t,n,o){o.setTitle("Simple Survey | Survey"),o.setLH(!0),e.question={},e.listOfAnswers={},n.getRandomQuestion(function(t){t.success===!0&&t.answers.length>0?(e.question=t.question,e.listOfAnswers=t.answers):e.question={text:"Looks like you've answered all our questions."}}),e.userResponse=function(){if(e.loading=!0,e.selectedAnswerPos>-1){var o=e.listOfAnswers[e.selectedAnswerPos];n.createUserResponse(o,function(n){n.success===!0?t.path("/survey"):(e.error="There was an error sending your response. Try again later.",e.loading=!1)})}else e.error="Please select an answer."}}]),angular.module("simpleSurveyUi").factory("AdminService",["$http",function(e){function t(t){e.get("/api/questions/").then(function(e){var n=e.data,o=[];n.forEach(function(e){var t=[],n=[],r=e.Responses.length;e.Answers.forEach(function(o){n[o.option]=0,e.Responses.forEach(function(e){n[e.option]++}),t.push({id:o.id,option:o.option,text:o.text,count:n[o.option]})}),o.push({id:e.id,text:e.text,total:r,Answers:t})}),t(o)})}function n(t,n){e.get("/api/questions/create",{text:t.text,answer1:t.answer1,answer2:t.answer2,answer3:t.answer3,answer4:t.answer4},function(e){var t={};e.data.success?t.success=!0:(t.success=!1,t.message="Failed to create question. Please try again later."),n(t)})}var o={};return o.getQuestionResponses=t,o.createQuestion=n,o}]),angular.module("simpleSurveyUi").factory("AuthenticationService",["$http","$localStorage",function(e,t){function n(n,o,r){e.post("/api/authenticate",{email:n,password:o}).then(function(n){var o=n.data;o.token&&(t.surveyUser={id:o.id,token:o.token},e.defaults.headers.common.Authorization="Bearer "+o.token),r(o)})}function o(){delete t.surveyUser,e.defaults.headers.common.Authorization=""}var r={};return r.Login=n,r.Logout=o,r}]),angular.module("simpleSurveyUi").factory("SurveyService",["$http","$localStorage",function(e,t){function n(n){var o=t.surveyUser;e.get("/api/users/"+o.id+"/questions").then(function(e){var t=e.data;n(t)})}function o(n,o){var r=t.surveyUser;e.post("/api/responses/users/"+r.id+"/questions/"+n.QuestionId+"/create",{option:n.option,text:n.text}).then(function(e){var t=e.data;console.log(t),o(t.UserId===r.id?{success:!0}:{success:!1})})}var r={};return r.getRandomQuestion=n,r.createUserResponse=o,r}]);